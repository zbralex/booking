import { Directive, EventEmitter, Input, NgZone, Output, } from '@angular/core';
import { Subscription } from 'rxjs';
import { EventManager } from '../../event-manager';
import { YaMapComponent } from '../ya-map/ya-map.component';
/**
 * The `ya-geoobject` component wraps `ymaps.GeoObject` class from the Yandex Maps API.
 * You can configure it via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/geoobject-polygon?embed=1</example-url>
 *
 * @example
 * ```html
 * <ya-map [center]="[55.761952, 37.620739]">
 *   <ya-geoobject
 *     [feature]="{ geometry: { type: 'Rectangle', coordinates: [[55.665, 37.66], [55.64,37.53]] } }"
 *   ></ya-geoobject>
 * </ya-map>
 * ```
 */
export class YaGeoObjectDirective {
    constructor(_ngZone, _yaMapComponent) {
        this._ngZone = _ngZone;
        this._yaMapComponent = _yaMapComponent;
        this._sub = new Subscription();
        this._eventManager = new EventManager(this._ngZone);
        /**
         * GeoObject instance is added in a Map.
         */
        this.ready = new EventEmitter();
        /**
         * Closing the balloon.
         */
        this.balloonclose = this._eventManager.getLazyEmitter('balloonclose');
        /**
         * Opening a balloon on a map.
         */
        this.balloonopen = this._eventManager.getLazyEmitter('balloonopen');
        /**
         * Event preceding the "drag" event.
         */
        this.beforedrag = this._eventManager.getLazyEmitter('beforedrag');
        /**
         * Event preceding the "dragstart" event.
         */
        this.beforedragstart = this._eventManager.getLazyEmitter('beforedragstart');
        /**
         * Single left-click on the object.
         */
        this.yaclick = this._eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         */
        this.yacontextmenu = this._eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         */
        this.yadblclick = this._eventManager.getLazyEmitter('dblclick');
        /**
         * Dragging a geo object.
         */
        this.yadrag = this._eventManager.getLazyEmitter('drag');
        /**
         * End of geo object dragging.
         */
        this.yadragend = this._eventManager.getLazyEmitter('dragend');
        /**
         * Start of geo object dragging.
         */
        this.yadragstart = this._eventManager.getLazyEmitter('dragstart');
        /**
         * Change in the state of the editor for the geo object's geometry.
         */
        this.editorstatechange = this._eventManager.getLazyEmitter('editorstatechange');
        /**
         * Change to the geo object geometry
         */
        this.geometrychange = this._eventManager.getLazyEmitter('geometrychange');
        /**
         * Closing the hint.
         */
        this.hintclose = this._eventManager.getLazyEmitter('hintclose');
        /**
         * Opening a hint on a map.
         */
        this.hintopen = this._eventManager.getLazyEmitter('hintopen');
        /**
         * Map reference changed.
         */
        this.mapchange = this._eventManager.getLazyEmitter('mapchange');
        /**
         * Pressing the mouse button over the object.
         */
        this.yamousedown = this._eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         */
        this.yamouseenter = this._eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         */
        this.yamouseleave = this._eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         */
        this.yamousemove = this._eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         */
        this.yamouseup = this._eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         */
        this.multitouchend = this._eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         */
        this.multitouchmove = this._eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         */
        this.multitouchstart = this._eventManager.getLazyEmitter('multitouchstart');
        /**
         * Change to the object options.
         */
        this.optionschange = this._eventManager.getLazyEmitter('optionschange');
        /**
         * Change to the geo object overlay.
         */
        this.overlaychange = this._eventManager.getLazyEmitter('overlaychange');
        /**
         * The parent object reference changed.
         */
        this.parentchange = this._eventManager.getLazyEmitter('parentchange');
        /**
         * Change to the geo object data.
         */
        this.propertieschange = this._eventManager.getLazyEmitter('propertieschange');
        /**
         * Mouse wheel scrolling.
         */
        this.yawheel = this._eventManager.getLazyEmitter('wheel');
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const { geoObject } = this;
        if (geoObject) {
            const { feature, options } = changes;
            if (feature) {
                this._setFeature(feature.currentValue, geoObject);
            }
            if (options) {
                geoObject.options.set(options.currentValue);
            }
        }
    }
    ngOnInit() {
        if (this._yaMapComponent.isBrowser) {
            const sub = this._yaMapComponent.map$.subscribe((map) => {
                if (map) {
                    const geoObject = this._createGeoObject();
                    this.geoObject = geoObject;
                    map.geoObjects.add(geoObject);
                    this._eventManager.setTarget(geoObject);
                    this._ngZone.run(() => this.ready.emit({ ymaps, target: geoObject }));
                }
            });
            this._sub.add(sub);
        }
    }
    ngOnDestroy() {
        var _a, _b;
        if (this.geoObject) {
            (_b = (_a = this._yaMapComponent) === null || _a === void 0 ? void 0 : _a.map$.value) === null || _b === void 0 ? void 0 : _b.geoObjects.remove(this.geoObject);
            this._eventManager.destroy();
        }
        this._sub.unsubscribe();
    }
    /**
     * Destructs feature and passes it in API.
     * @param feature
     * @param geoObject
     */
    _setFeature(feature, geoObject) {
        const { geometry, properties } = feature;
        if (geometry) {
            console.warn('The geometry can not be changed after entity init. To set it, you should recreate a GeoObject with new feature.geometry');
        }
        if (properties) {
            geoObject.properties.set(properties);
        }
    }
    /**
     * Creates GeoObject.
     */
    _createGeoObject() {
        return new ymaps.GeoObject(this.feature, this.options);
    }
}
YaGeoObjectDirective.decorators = [
    { type: Directive, args: [{
                selector: 'ya-geoobject',
            },] }
];
YaGeoObjectDirective.ctorParameters = () => [
    { type: NgZone },
    { type: YaMapComponent }
];
YaGeoObjectDirective.propDecorators = {
    feature: [{ type: Input }],
    options: [{ type: Input }],
    ready: [{ type: Output }],
    balloonclose: [{ type: Output }],
    balloonopen: [{ type: Output }],
    beforedrag: [{ type: Output }],
    beforedragstart: [{ type: Output }],
    yaclick: [{ type: Output }],
    yacontextmenu: [{ type: Output }],
    yadblclick: [{ type: Output }],
    yadrag: [{ type: Output }],
    yadragend: [{ type: Output }],
    yadragstart: [{ type: Output }],
    editorstatechange: [{ type: Output }],
    geometrychange: [{ type: Output }],
    hintclose: [{ type: Output }],
    hintopen: [{ type: Output }],
    mapchange: [{ type: Output }],
    yamousedown: [{ type: Output }],
    yamouseenter: [{ type: Output }],
    yamouseleave: [{ type: Output }],
    yamousemove: [{ type: Output }],
    yamouseup: [{ type: Output }],
    multitouchend: [{ type: Output }],
    multitouchmove: [{ type: Output }],
    multitouchstart: [{ type: Output }],
    optionschange: [{ type: Output }],
    overlaychange: [{ type: Output }],
    parentchange: [{ type: Output }],
    propertieschange: [{ type: Output }],
    yawheel: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtZ2Vvb2JqZWN0LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXI4LXlhbmRleC1tYXBzL3NyYy9saWIvY29tcG9uZW50cy95YS1nZW9vYmplY3QveWEtZ2Vvb2JqZWN0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUlOLE1BQU0sR0FFUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWMsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFJNUQ7Ozs7Ozs7Ozs7Ozs7OztHQWVHO0FBSUgsTUFBTSxPQUFPLG9CQUFvQjtJQWtNL0IsWUFBNkIsT0FBZSxFQUFtQixlQUErQjtRQUFqRSxZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQW1CLG9CQUFlLEdBQWYsZUFBZSxDQUFnQjtRQWpNN0UsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUIsa0JBQWEsR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFnQmhFOztXQUVHO1FBQ08sVUFBSyxHQUFnRCxJQUFJLFlBQVksRUFFNUUsQ0FBQztRQUVKOztXQUVHO1FBQ08saUJBQVksR0FDcEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFcEQ7O1dBRUc7UUFDTyxnQkFBVyxHQUNuQixJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUVuRDs7V0FFRztRQUNPLGVBQVUsR0FDbEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsWUFBWSxD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QU1OLE1BQU07NkJBTU4sTUFBTTt3QkFNTixNQUFNO3VCQU1OLE1BQU07d0JBTU4sTUFBTTswQkFNTixNQUFNOzJCQU1OLE1BQU07MkJBTU4sTUFBTTswQkFNTixNQUFNO3dCQU1OLE1BQU07NEJBTU4sTUFBTTs2QkFNTixNQUFNOzhCQU1OLE1BQU07NEJBTU4sTUFBTTs0QkFNTixNQUFNOzJCQU1OLE1BQU07K0JBTU4sTUFBTTtzQkFNTixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE5nWm9uZSxcclxuICBPbkNoYW5nZXMsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJy4uLy4uL2V2ZW50LW1hbmFnZXInO1xyXG5pbXBvcnQgeyBZYU1hcENvbXBvbmVudCB9IGZyb20gJy4uL3lhLW1hcC95YS1tYXAuY29tcG9uZW50JztcclxuaW1wb3J0IHsgWWFSZWFkeUV2ZW50IH0gZnJvbSAnLi4vLi4vdHlwaW5ncy95YS1yZWFkeS1ldmVudCc7XHJcbmltcG9ydCB7IFlhRXZlbnQgfSBmcm9tICcuLi8uLi90eXBpbmdzL3lhLWV2ZW50JztcclxuXHJcbi8qKlxyXG4gKiBUaGUgYHlhLWdlb29iamVjdGAgY29tcG9uZW50IHdyYXBzIGB5bWFwcy5HZW9PYmplY3RgIGNsYXNzIGZyb20gdGhlIFlhbmRleCBNYXBzIEFQSS5cclxuICogWW91IGNhbiBjb25maWd1cmUgaXQgdmlhIHRoZSBjb21wb25lbnQncyBpbnB1dHMuXHJcbiAqIEV2ZW50cyBjYW4gYmUgYm91bmQgdXNpbmcgdGhlIG91dHB1dHMgb2YgdGhlIGNvbXBvbmVudC5cclxuICpcclxuICogPGV4YW1wbGUtdXJsPmh0dHBzOi8vc3RhY2tibGl0ei5jb20vZWRpdC9nZW9vYmplY3QtcG9seWdvbj9lbWJlZD0xPC9leGFtcGxlLXVybD5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgaHRtbFxyXG4gKiA8eWEtbWFwIFtjZW50ZXJdPVwiWzU1Ljc2MTk1MiwgMzcuNjIwNzM5XVwiPlxyXG4gKiAgIDx5YS1nZW9vYmplY3RcclxuICogICAgIFtmZWF0dXJlXT1cInsgZ2VvbWV0cnk6IHsgdHlwZTogJ1JlY3RhbmdsZScsIGNvb3JkaW5hdGVzOiBbWzU1LjY2NSwgMzcuNjZdLCBbNTUuNjQsMzcuNTNdXSB9IH1cIlxyXG4gKiAgID48L3lhLWdlb29iamVjdD5cclxuICogPC95YS1tYXA+XHJcbiAqIGBgYFxyXG4gKi9cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICd5YS1nZW9vYmplY3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgWWFHZW9PYmplY3REaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9zdWIgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2V2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIodGhpcy5fbmdab25lKTtcclxuXHJcbiAgZ2VvT2JqZWN0PzogeW1hcHMuR2VvT2JqZWN0O1xyXG5cclxuICAvKipcclxuICAgKiBGZWF0dXJlIGZvciB0aGUgR2VvT2JqZWN0LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0dlb09iamVjdC5odG1sI0dlb09iamVjdHBhcmFtLWZlYXR1cmV9XHJcbiAgICovXHJcbiAgQElucHV0KCkgZmVhdHVyZTogeW1hcHMuSUdlb09iamVjdEZlYXR1cmU7XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wdGlvbnMgZm9yIHRoZSBHZW9PYmplY3QuXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvR2VvT2JqZWN0Lmh0bWwjR2VvT2JqZWN0cGFyYW0tb3B0aW9uc31cclxuICAgKi9cclxuICBASW5wdXQoKSBvcHRpb25zOiB5bWFwcy5JR2VvT2JqZWN0T3B0aW9ucztcclxuXHJcbiAgLyoqXHJcbiAgICogR2VvT2JqZWN0IGluc3RhbmNlIGlzIGFkZGVkIGluIGEgTWFwLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSByZWFkeTogRXZlbnRFbWl0dGVyPFlhUmVhZHlFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9IG5ldyBFdmVudEVtaXR0ZXI8XHJcbiAgICBZYVJlYWR5RXZlbnQ8eW1hcHMuR2VvT2JqZWN0PlxyXG4gID4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2xvc2luZyB0aGUgYmFsbG9vbi5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgYmFsbG9vbmNsb3NlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdiYWxsb29uY2xvc2UnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogT3BlbmluZyBhIGJhbGxvb24gb24gYSBtYXAuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGJhbGxvb25vcGVuOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdiYWxsb29ub3BlbicpO1xyXG5cclxuICAvKipcclxuICAgKiBFdmVudCBwcmVjZWRpbmcgdGhlIFwiZHJhZ1wiIGV2ZW50LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBiZWZvcmVkcmFnOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdiZWZvcmVkcmFnJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEV2ZW50IHByZWNlZGluZyB0aGUgXCJkcmFnc3RhcnRcIiBldmVudC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgYmVmb3JlZHJhZ3N0YXJ0OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdiZWZvcmVkcmFnc3RhcnQnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogU2luZ2xlIGxlZnQtY2xpY2sgb24gdGhlIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFjbGljazogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignY2xpY2snKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsbHMgdGhlIGVsZW1lbnQncyBjb250ZXh0IG1lbnUuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhY29udGV4dG1lbnU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2NvbnRleHRtZW51Jyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIERvdWJsZSBsZWZ0LWNsaWNrIG9uIHRoZSBvYmplY3QuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhZGJsY2xpY2s6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2RibGNsaWNrJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIERyYWdnaW5nIGEgZ2VvIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFkcmFnOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdkcmFnJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEVuZCBvZiBnZW8gb2JqZWN0IGRyYWdnaW5nLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YWRyYWdlbmQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2RyYWdlbmQnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgb2YgZ2VvIG9iamVjdCBkcmFnZ2luZy5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFkcmFnc3RhcnQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2RyYWdzdGFydCcpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgaW4gdGhlIHN0YXRlIG9mIHRoZSBlZGl0b3IgZm9yIHRoZSBnZW8gb2JqZWN0J3MgZ2VvbWV0cnkuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGVkaXRvcnN0YXRlY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdlZGl0b3JzdGF0ZWNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3QgZ2VvbWV0cnlcclxuICAgKi9cclxuICBAT3V0cHV0KCkgZ2VvbWV0cnljaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2dlb21ldHJ5Y2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsb3NpbmcgdGhlIGhpbnQuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGhpbnRjbG9zZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignaGludGNsb3NlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wZW5pbmcgYSBoaW50IG9uIGEgbWFwLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBoaW50b3BlbjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignaGludG9wZW4nKTtcclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIHJlZmVyZW5jZSBjaGFuZ2VkLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBtYXBjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21hcGNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBQcmVzc2luZyB0aGUgbW91c2UgYnV0dG9uIG92ZXIgdGhlIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZWRvd246IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlZG93bicpO1xyXG5cclxuICAvKipcclxuICAgKiBQb2ludGluZyB0aGUgY3Vyc29yIGF0IHRoZSBvYmplY3QuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhbW91c2VlbnRlcjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2VlbnRlcicpO1xyXG5cclxuICAvKipcclxuICAgKiBNb3ZpbmcgdGhlIGN1cnNvciBvZmYgb2YgdGhlIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZWxlYXZlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWxlYXZlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmluZyB0aGUgY3Vyc29yIG92ZXIgdGhlIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZW1vdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlbW92ZScpO1xyXG5cclxuICAvKipcclxuICAgKiBMZXR0aW5nIGdvIG9mIHRoZSBtb3VzZSBidXR0b24gb3ZlciBhbiBvYmplY3QuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhbW91c2V1cDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2V1cCcpO1xyXG5cclxuICAvKipcclxuICAgKiBFbmQgb2YgbXVsdGl0b3VjaC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgbXVsdGl0b3VjaGVuZDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaGVuZCcpO1xyXG5cclxuICAvKipcclxuICAgKiBSZXBlYXRpbmcgZXZlbnQgZHVyaW5nIG11bHRpdG91Y2guXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG11bHRpdG91Y2htb3ZlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtdWx0aXRvdWNobW92ZScpO1xyXG5cclxuICAvKipcclxuICAgKiBTdGFydCBvZiBtdWx0aXRvdWNoLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNoc3RhcnQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ211bHRpdG91Y2hzdGFydCcpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIG9iamVjdCBvcHRpb25zLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBvcHRpb25zY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdvcHRpb25zY2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIENoYW5nZSB0byB0aGUgZ2VvIG9iamVjdCBvdmVybGF5LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBvdmVybGF5Y2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuR2VvT2JqZWN0Pj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdvdmVybGF5Y2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBwYXJlbnQgb2JqZWN0IHJlZmVyZW5jZSBjaGFuZ2VkLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBwYXJlbnRjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3BhcmVudGNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3QgZGF0YS5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgcHJvcGVydGllc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLkdlb09iamVjdD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcigncHJvcGVydGllc2NoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBNb3VzZSB3aGVlbCBzY3JvbGxpbmcuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhd2hlZWw6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5HZW9PYmplY3Q+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3doZWVsJyk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgX25nWm9uZTogTmdab25lLCBwcml2YXRlIHJlYWRvbmx5IF95YU1hcENvbXBvbmVudDogWWFNYXBDb21wb25lbnQpIHt9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZXMgaW5wdXQgY2hhbmdlcyBhbmQgcGFzc2VzIHRoZW0gaW4gQVBJLlxyXG4gICAqIEBwYXJhbSBjaGFuZ2VzXHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBnZW9PYmplY3QgfSA9IHRoaXM7XHJcblxyXG4gICAgaWYgKGdlb09iamVjdCkge1xyXG4gICAgICBjb25zdCB7IGZlYXR1cmUsIG9wdGlvbnMgfSA9IGNoYW5nZXM7XHJcblxyXG4gICAgICBpZiAoZmVhdHVyZSkge1xyXG4gICAgICAgIHRoaXMuX3NldEZlYXR1cmUoZmVhdHVyZS5jdXJyZW50VmFsdWUsIGdlb09iamVjdCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgZ2VvT2JqZWN0Lm9wdGlvbnMuc2V0KG9wdGlvbnMuY3VycmVudFZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5feWFNYXBDb21wb25lbnQuaXNCcm93c2VyKSB7XHJcbiAgICAgIGNvbnN0IHN1YiA9IHRoaXMuX3lhTWFwQ29tcG9uZW50Lm1hcCQuc3Vic2NyaWJlKChtYXApID0+IHtcclxuICAgICAgICBpZiAobWFwKSB7XHJcbiAgICAgICAgICBjb25zdCBnZW9PYmplY3QgPSB0aGlzLl9jcmVhdGVHZW9PYmplY3QoKTtcclxuICAgICAgICAgIHRoaXMuZ2VvT2JqZWN0ID0gZ2VvT2JqZWN0O1xyXG5cclxuICAgICAgICAgIG1hcC5nZW9PYmplY3RzLmFkZChnZW9PYmplY3QpO1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRNYW5hZ2VyLnNldFRhcmdldChnZW9PYmplY3QpO1xyXG4gICAgICAgICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB0aGlzLnJlYWR5LmVtaXQoeyB5bWFwcywgdGFyZ2V0OiBnZW9PYmplY3QgfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLl9zdWIuYWRkKHN1Yik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmdlb09iamVjdCkge1xyXG4gICAgICB0aGlzLl95YU1hcENvbXBvbmVudD8ubWFwJC52YWx1ZT8uZ2VvT2JqZWN0cy5yZW1vdmUodGhpcy5nZW9PYmplY3QpO1xyXG4gICAgICB0aGlzLl9ldmVudE1hbmFnZXIuZGVzdHJveSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3N1Yi51bnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVzdHJ1Y3RzIGZlYXR1cmUgYW5kIHBhc3NlcyBpdCBpbiBBUEkuXHJcbiAgICogQHBhcmFtIGZlYXR1cmVcclxuICAgKiBAcGFyYW0gZ2VvT2JqZWN0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfc2V0RmVhdHVyZShmZWF0dXJlOiB5bWFwcy5JR2VvT2JqZWN0RmVhdHVyZSwgZ2VvT2JqZWN0OiB5bWFwcy5HZW9PYmplY3QpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgZ2VvbWV0cnksIHByb3BlcnRpZXMgfSA9IGZlYXR1cmU7XHJcblxyXG4gICAgaWYgKGdlb21ldHJ5KSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICAnVGhlIGdlb21ldHJ5IGNhbiBub3QgYmUgY2hhbmdlZCBhZnRlciBlbnRpdHkgaW5pdC4gVG8gc2V0IGl0LCB5b3Ugc2hvdWxkIHJlY3JlYXRlIGEgR2VvT2JqZWN0IHdpdGggbmV3IGZlYXR1cmUuZ2VvbWV0cnknLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcm9wZXJ0aWVzKSB7XHJcbiAgICAgIGdlb09iamVjdC5wcm9wZXJ0aWVzLnNldChwcm9wZXJ0aWVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgR2VvT2JqZWN0LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgX2NyZWF0ZUdlb09iamVjdCgpOiB5bWFwcy5HZW9PYmplY3Qge1xyXG4gICAgcmV0dXJuIG5ldyB5bWFwcy5HZW9PYmplY3QodGhpcy5mZWF0dXJlLCB0aGlzLm9wdGlvbnMpO1xyXG4gIH1cclxufVxyXG4iXX0=