import { ChangeDetectionStrategy, Component, EventEmitter, Inject, Input, NgZone, Output, PLATFORM_ID, ViewChild, } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { BehaviorSubject, Subscription } from 'rxjs';
import { EventManager } from '../../event-manager';
import { generateRandomId } from '../../utils/generate-random-id';
import { YaApiLoaderService } from '../../services/ya-api-loader/ya-api-loader.service';
/**
 * The `ya-map` component wraps `ymaps.Map` class from the Yandex Maps API.
 * You can configure the map via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/map-onload-event?embed=1</example-url>
 *
 * @example
 * ```html
 * <ya-map
 *   [center]="[55.751952, 37.600739]"
 *   [state]="{type: 'yandex#satellite'}"
 * ></ya-map>
 * ```
 */
export class YaMapComponent {
    constructor(_ngZone, _yaApiLoaderService, platformId) {
        this._ngZone = _ngZone;
        this._yaApiLoaderService = _yaApiLoaderService;
        this._sub = new Subscription();
        this._eventManager = new EventManager(this._ngZone);
        this.map$ = new BehaviorSubject(undefined);
        /**
         * Map instance is created.
         */
        this.ready = new EventEmitter();
        /**
         * The start of a new smooth map movement.
         */
        this.actionbegin = this._eventManager.getLazyEmitter('actionbegin');
        /**
         * Event that occurs when an action step was prematurely stopped.
         */
        this.actionbreak = this._eventManager.getLazyEmitter('actionbreak');
        /**
         * The end of smooth map movement.
         */
        this.actionend = this._eventManager.getLazyEmitter('actionend');
        /**
         * The start of a new step of smooth movement.
         */
        this.actiontick = this._eventManager.getLazyEmitter('actiontick');
        /**
         * The end of performing a step of smooth movement.
         */
        this.actiontickcomplete = this._eventManager.getLazyEmitter('actiontickcomplete');
        /**
         * Closing the balloon.
         */
        this.balloonclose = this._eventManager.getLazyEmitter('balloonclose');
        /**
         * Opening a balloon on a map.
         */
        this.balloonopen = this._eventManager.getLazyEmitter('balloonopen');
        /**
         * Event for a change to the map viewport.
         */
        this.boundschange = this._eventManager.getLazyEmitter('boundschange');
        /**
         * Single left-click on the object.
         */
        this.yaclick = this._eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         */
        this.yacontextmenu = this._eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         */
        this.yadblclick = this._eventManager.getLazyEmitter('dblclick');
        /**
         * The map was destroyed.
         */
        this.destroy = this._eventManager.getLazyEmitter('destroy');
        /**
         * Closing the hint.
         */
        this.hintclose = this._eventManager.getLazyEmitter('hintclose');
        /**
         * Opening a hint on a map.
         */
        this.hintopen = this._eventManager.getLazyEmitter('hintopen');
        /**
         * Map margins changed.
         */
        this.marginchange = this._eventManager.getLazyEmitter('marginchange');
        /**
         * Pressing the mouse button over the object.
         */
        this.yamousedown = this._eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         */
        this.yamouseenter = this._eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         */
        this.yamouseleave = this._eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         */
        this.yamousemove = this._eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         */
        this.yamouseup = this._eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         */
        this.multitouchend = this._eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         */
        this.multitouchmove = this._eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         */
        this.multitouchstart = this._eventManager.getLazyEmitter('multitouchstart');
        /**
         * Map options changed.
         */
        this.optionschange = this._eventManager.getLazyEmitter('optionschange');
        /**
         * Map size changed.
         */
        this.sizechange = this._eventManager.getLazyEmitter('sizechange');
        /**
         * The map type changed.
         */
        this.typechange = this._eventManager.getLazyEmitter('typechange');
        /**
         * Mouse wheel scrolling.
         */
        this.yawheel = this._eventManager.getLazyEmitter('wheel');
        this.isBrowser = isPlatformBrowser(platformId);
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const map = this.map$.value;
        if (map) {
            const { center, zoom, state, options } = changes;
            if (state) {
                this._setState(this._combineState(), map);
            }
            if (center) {
                map.setCenter(center.currentValue);
            }
            if (zoom) {
                map.setZoom(zoom.currentValue);
            }
            if (options) {
                map.options.set(options.currentValue);
            }
        }
    }
    ngAfterViewInit() {
        /**
         * It should be a noop during server-side rendering.
         */
        if (this.isBrowser) {
            const sub = this._yaApiLoaderService.load().subscribe(() => {
                const id = generateRandomId();
                const map = this._createMap(id);
                this.map$.next(map);
                this._eventManager.setTarget(map);
                this._ngZone.run(() => this.ready.emit({ ymaps, target: map }));
            });
            this._sub.add(sub);
        }
    }
    ngOnDestroy() {
        this._eventManager.destroy();
        this._sub.unsubscribe();
    }
    /**
     * Destructs state and passes it in API.
     * @param state
     * @param map
     */
    _setState(state, map) {
        const { behaviors, bounds, center, controls, margin, type, zoom } = state;
        if (behaviors) {
            map.behaviors.enable(behaviors);
        }
        if (bounds) {
            map.setBounds(bounds);
        }
        if (center) {
            map.setCenter(center);
        }
        if (controls) {
            controls.forEach((control) => map.controls.add(control));
        }
        if (margin) {
            map.margin.setDefaultMargin(margin);
        }
        if (type) {
            map.setType(type);
        }
        if (zoom) {
            map.setZoom(zoom);
        }
    }
    /**
     * Creates a map.
     * @param id ID which will be set to the map container.
     */
    _createMap(id) {
        const containerElem = this.container.nativeElement;
        containerElem.setAttribute('id', id);
        containerElem.style.cssText = 'width: 100%; height: 100%;';
        return new ymaps.Map(id, this._combineState(), this.options || {});
    }
    /**
     * Combines the center and zoom into single object.
     */
    _combineState() {
        var _a, _b;
        const state = this.state || {};
        return Object.assign(Object.assign({}, state), { center: this.center || state.center || [0, 0], zoom: (_b = (_a = this.zoom) !== null && _a !== void 0 ? _a : state.zoom) !== null && _b !== void 0 ? _b : 10 });
    }
}
YaMapComponent.decorators = [
    { type: Component, args: [{
                selector: 'ya-map',
                template: '<div #container></div>',
                changeDetection: ChangeDetectionStrategy.OnPush
            },] }
];
YaMapComponent.ctorParameters = () => [
    { type: NgZone },
    { type: YaApiLoaderService },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
YaMapComponent.propDecorators = {
    container: [{ type: ViewChild, args: ['container',] }],
    center: [{ type: Input }],
    zoom: [{ type: Input }],
    state: [{ type: Input }],
    options: [{ type: Input }],
    ready: [{ type: Output }],
    actionbegin: [{ type: Output }],
    actionbreak: [{ type: Output }],
    actionend: [{ type: Output }],
    actiontick: [{ type: Output }],
    actiontickcomplete: [{ type: Output }],
    balloonclose: [{ type: Output }],
    balloonopen: [{ type: Output }],
    boundschange: [{ type: Output }],
    yaclick: [{ type: Output }],
    yacontextmenu: [{ type: Output }],
    yadblclick: [{ type: Output }],
    destroy: [{ type: Output }],
    hintclose: [{ type: Output }],
    hintopen: [{ type: Output }],
    marginchange: [{ type: Output }],
    yamousedown: [{ type: Output }],
    yamouseenter: [{ type: Output }],
    yamouseleave: [{ type: Output }],
    yamousemove: [{ type: Output }],
    yamouseup: [{ type: Output }],
    multitouchend: [{ type: Output }],
    multitouchmove: [{ type: Output }],
    multitouchstart: [{ type: Output }],
    optionschange: [{ type: Output }],
    sizechange: [{ type: Output }],
    typechange: [{ type: Output }],
    yawheel: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtbWFwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXI4LXlhbmRleC1tYXBzL3NyYy9saWIvY29tcG9uZW50cy95YS1tYXAveWEtbWFwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFFVCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFDTCxNQUFNLEVBR04sTUFBTSxFQUNOLFdBQVcsRUFFWCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBSXhGOzs7Ozs7Ozs7Ozs7OztHQWNHO0FBTUgsTUFBTSxPQUFPLGNBQWM7SUEyTXpCLFlBQ21CLE9BQWUsRUFDZixtQkFBdUMsRUFDbkMsVUFBa0I7UUFGdEIsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNmLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBb0I7UUExTXpDLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTFCLGtCQUFhLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWhFLFNBQUksR0FBRyxJQUFJLGVBQWUsQ0FBd0IsU0FBUyxDQUFDLENBQUM7UUE4QjdEOztXQUVHO1FBQ08sVUFBSyxHQUEwQyxJQUFJLFlBQVksRUFFdEUsQ0FBQztRQUVKOztXQUVHO1FBQ08sZ0JBQVcsR0FD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QUFRO2dCQUNsQixRQUFRLEVBQUUsd0JBQXdCO2dCQUNsQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7O1lBbkNDLE1BQU07WUFZQyxrQkFBa0I7WUFzT1UsTUFBTSx1QkFBdEMsTUFBTSxTQUFDLFdBQVc7Ozt3QkE3TXBCLFNBQVMsU0FBQyxXQUFXO3FCQWVyQixLQUFLO21CQU9MLEtBQUs7b0JBTUwsS0FBSztzQkFNTCxLQUFLO29CQUtMLE1BQU07MEJBT04sTUFBTTswQkFNTixNQUFNO3dCQU1OLE1BQU07eUJBTU4sTUFBTTtpQ0FNTixNQUFNOzJCQU1OLE1BQU07MEJBTU4sTUFBTTsyQkFNTixNQUFNO3NCQU1OLE1BQU07NEJBS04sTUFBTTt5QkFNTixNQUFNO3NCQU1OLE1BQU07d0JBS04sTUFBTTt1QkFNTixNQUFNOzJCQU1OLE1BQU07MEJBTU4sTUFBTTsyQkFNTixNQUFNOzJCQU1OLE1BQU07MEJBTU4sTUFBTTt3QkFNTixNQUFNOzRCQU1OLE1BQU07NkJBTU4sTUFBTTs4QkFNTixNQUFNOzRCQU1OLE1BQU07eUJBTU4sTUFBTTt5QkFNTixNQUFNO3NCQU1OLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIEluamVjdCxcclxuICBJbnB1dCxcclxuICBOZ1pvbmUsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIE9uRGVzdHJveSxcclxuICBPdXRwdXQsXHJcbiAgUExBVEZPUk1fSUQsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBWaWV3Q2hpbGQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vZXZlbnQtbWFuYWdlcic7XHJcbmltcG9ydCB7IGdlbmVyYXRlUmFuZG9tSWQgfSBmcm9tICcuLi8uLi91dGlscy9nZW5lcmF0ZS1yYW5kb20taWQnO1xyXG5pbXBvcnQgeyBZYUFwaUxvYWRlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy95YS1hcGktbG9hZGVyL3lhLWFwaS1sb2FkZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IFlhUmVhZHlFdmVudCB9IGZyb20gJy4uLy4uL3R5cGluZ3MveWEtcmVhZHktZXZlbnQnO1xyXG5pbXBvcnQgeyBZYUV2ZW50IH0gZnJvbSAnLi4vLi4vdHlwaW5ncy95YS1ldmVudCc7XHJcblxyXG4vKipcclxuICogVGhlIGB5YS1tYXBgIGNvbXBvbmVudCB3cmFwcyBgeW1hcHMuTWFwYCBjbGFzcyBmcm9tIHRoZSBZYW5kZXggTWFwcyBBUEkuXHJcbiAqIFlvdSBjYW4gY29uZmlndXJlIHRoZSBtYXAgdmlhIHRoZSBjb21wb25lbnQncyBpbnB1dHMuXHJcbiAqIEV2ZW50cyBjYW4gYmUgYm91bmQgdXNpbmcgdGhlIG91dHB1dHMgb2YgdGhlIGNvbXBvbmVudC5cclxuICpcclxuICogPGV4YW1wbGUtdXJsPmh0dHBzOi8vc3RhY2tibGl0ei5jb20vZWRpdC9tYXAtb25sb2FkLWV2ZW50P2VtYmVkPTE8L2V4YW1wbGUtdXJsPlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBodG1sXHJcbiAqIDx5YS1tYXBcclxuICogICBbY2VudGVyXT1cIls1NS43NTE5NTIsIDM3LjYwMDczOV1cIlxyXG4gKiAgIFtzdGF0ZV09XCJ7dHlwZTogJ3lhbmRleCNzYXRlbGxpdGUnfVwiXHJcbiAqID48L3lhLW1hcD5cclxuICogYGBgXHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3lhLW1hcCcsXHJcbiAgdGVtcGxhdGU6ICc8ZGl2ICNjb250YWluZXI+PC9kaXY+JyxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcclxufSlcclxuZXhwb3J0IGNsYXNzIFlhTWFwQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicpIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfc3ViID0gbmV3IFN1YnNjcmlwdGlvbigpO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9ldmVudE1hbmFnZXIgPSBuZXcgRXZlbnRNYW5hZ2VyKHRoaXMuX25nWm9uZSk7XHJcblxyXG4gIG1hcCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHltYXBzLk1hcCB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcclxuXHJcbiAgaXNCcm93c2VyOiBib29sZWFuO1xyXG5cclxuICAvKipcclxuICAgKiBNYXAgY2VudGVyIGdlb2Nvb3JkaW5hdGVzLiBEZWZhdWx0IGlzIFswLCAwXS5cclxuICAgKiBTaG9ydGhhbmQgZm9yIFtzdGF0ZV09XCJ7IGNlbnRlcjogWzAsIDBdIH1cIi5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9NYXAuaHRtbCNNYXBfX3BhcmFtLXN0YXRlLmNlbnRlcn1cclxuICAgKi9cclxuICBASW5wdXQoKSBjZW50ZXI6IG51bWJlcltdO1xyXG5cclxuICAvKipcclxuICAgKiBNYXAgem9vbSBsZXZlbC4gRGVmYXVsdCBsZXZlbCBpcyAxMC5cclxuICAgKiBTaG9ydGhhbmQgZm9yIFtzdGF0ZV09XCJ7IHpvb206IDEwIH1cIi5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9NYXAuaHRtbCNNYXBfX3BhcmFtLXN0YXRlLnpvb219XHJcbiAgICovXHJcbiAgQElucHV0KCkgem9vbTogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBTdGF0ZXMgZm9yIHRoZSBtYXAuXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvTWFwLmh0bWwjTWFwcGFyYW0tc3RhdGV9XHJcbiAgICovXHJcbiAgQElucHV0KCkgc3RhdGU6IHltYXBzLklNYXBTdGF0ZTtcclxuXHJcbiAgLyoqXHJcbiAgICogT3B0aW9ucyBmb3IgdGhlIG1hcC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9NYXAuaHRtbCNNYXBwYXJhbS1vcHRpb25zfVxyXG4gICAqL1xyXG4gIEBJbnB1dCgpIG9wdGlvbnM6IHltYXBzLklNYXBPcHRpb25zO1xyXG5cclxuICAvKipcclxuICAgKiBNYXAgaW5zdGFuY2UgaXMgY3JlYXRlZC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgcmVhZHk6IEV2ZW50RW1pdHRlcjxZYVJlYWR5RXZlbnQ8eW1hcHMuTWFwPj4gPSBuZXcgRXZlbnRFbWl0dGVyPFxyXG4gICAgWWFSZWFkeUV2ZW50PHltYXBzLk1hcD5cclxuICA+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBzdGFydCBvZiBhIG5ldyBzbW9vdGggbWFwIG1vdmVtZW50LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBhY3Rpb25iZWdpbjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignYWN0aW9uYmVnaW4nKTtcclxuXHJcbiAgLyoqXHJcbiAgICogRXZlbnQgdGhhdCBvY2N1cnMgd2hlbiBhbiBhY3Rpb24gc3RlcCB3YXMgcHJlbWF0dXJlbHkgc3RvcHBlZC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgYWN0aW9uYnJlYWs6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2FjdGlvbmJyZWFrJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBlbmQgb2Ygc21vb3RoIG1hcCBtb3ZlbWVudC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgYWN0aW9uZW5kOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdhY3Rpb25lbmQnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogVGhlIHN0YXJ0IG9mIGEgbmV3IHN0ZXAgb2Ygc21vb3RoIG1vdmVtZW50LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBhY3Rpb250aWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdhY3Rpb250aWNrJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBlbmQgb2YgcGVyZm9ybWluZyBhIHN0ZXAgb2Ygc21vb3RoIG1vdmVtZW50LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBhY3Rpb250aWNrY29tcGxldGU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2FjdGlvbnRpY2tjb21wbGV0ZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDbG9zaW5nIHRoZSBiYWxsb29uLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBiYWxsb29uY2xvc2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2JhbGxvb25jbG9zZScpO1xyXG5cclxuICAvKipcclxuICAgKiBPcGVuaW5nIGEgYmFsbG9vbiBvbiBhIG1hcC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgYmFsbG9vbm9wZW46IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2JhbGxvb25vcGVuJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEV2ZW50IGZvciBhIGNoYW5nZSB0byB0aGUgbWFwIHZpZXdwb3J0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBib3VuZHNjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2JvdW5kc2NoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBTaW5nbGUgbGVmdC1jbGljayBvbiB0aGUgb2JqZWN0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YWNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPSB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2NsaWNrJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGxzIHRoZSBlbGVtZW50J3MgY29udGV4dCBtZW51LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YWNvbnRleHRtZW51OiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdjb250ZXh0bWVudScpO1xyXG5cclxuICAvKipcclxuICAgKiBEb3VibGUgbGVmdC1jbGljayBvbiB0aGUgb2JqZWN0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YWRibGNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdkYmxjbGljaycpO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgbWFwIHdhcyBkZXN0cm95ZWQuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGRlc3Ryb3k6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9IHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZGVzdHJveScpO1xyXG5cclxuICAvKipcclxuICAgKiBDbG9zaW5nIHRoZSBoaW50LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBoaW50Y2xvc2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRjbG9zZScpO1xyXG5cclxuICAvKipcclxuICAgKiBPcGVuaW5nIGEgaGludCBvbiBhIG1hcC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgaGludG9wZW46IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRvcGVuJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJnaW5zIGNoYW5nZWQuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG1hcmdpbmNoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbWFyZ2luY2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFByZXNzaW5nIHRoZSBtb3VzZSBidXR0b24gb3ZlciB0aGUgb2JqZWN0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YW1vdXNlZG93bjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2Vkb3duJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFBvaW50aW5nIHRoZSBjdXJzb3IgYXQgdGhlIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZWVudGVyOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWVudGVyJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmluZyB0aGUgY3Vyc29yIG9mZiBvZiB0aGUgb2JqZWN0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YW1vdXNlbGVhdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlbGVhdmUnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogTW92aW5nIHRoZSBjdXJzb3Igb3ZlciB0aGUgb2JqZWN0LlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YW1vdXNlbW92ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2Vtb3ZlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIExldHRpbmcgZ28gb2YgdGhlIG1vdXNlIGJ1dHRvbiBvdmVyIGFuIG9iamVjdC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZXVwOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZXVwJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEVuZCBvZiBtdWx0aXRvdWNoLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNoZW5kOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuTWFwPj4gPVxyXG4gICAgdGhpcy5fZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtdWx0aXRvdWNoZW5kJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlcGVhdGluZyBldmVudCBkdXJpbmcgbXVsdGl0b3VjaC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgbXVsdGl0b3VjaG1vdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ211bHRpdG91Y2htb3ZlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IG9mIG11bHRpdG91Y2guXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG11bHRpdG91Y2hzdGFydDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaHN0YXJ0Jyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBvcHRpb25zIGNoYW5nZWQuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG9wdGlvbnNjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ29wdGlvbnNjaGFuZ2UnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIHNpemUgY2hhbmdlZC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgc2l6ZWNoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignc2l6ZWNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgbWFwIHR5cGUgY2hhbmdlZC5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgdHlwZWNoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk1hcD4+ID1cclxuICAgIHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcigndHlwZWNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBNb3VzZSB3aGVlbCBzY3JvbGxpbmcuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhd2hlZWw6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5NYXA+PiA9IHRoaXMuX2V2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignd2hlZWwnKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9uZ1pvbmU6IE5nWm9uZSxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3lhQXBpTG9hZGVyU2VydmljZTogWWFBcGlMb2FkZXJTZXJ2aWNlLFxyXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZDogT2JqZWN0LFxyXG4gICkge1xyXG4gICAgdGhpcy5pc0Jyb3dzZXIgPSBpc1BsYXRmb3JtQnJvd3NlcihwbGF0Zm9ybUlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZXMgaW5wdXQgY2hhbmdlcyBhbmQgcGFzc2VzIHRoZW0gaW4gQVBJLlxyXG4gICAqIEBwYXJhbSBjaGFuZ2VzXHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgbWFwID0gdGhpcy5tYXAkLnZhbHVlO1xyXG5cclxuICAgIGlmIChtYXApIHtcclxuICAgICAgY29uc3QgeyBjZW50ZXIsIHpvb20sIHN0YXRlLCBvcHRpb25zIH0gPSBjaGFuZ2VzO1xyXG5cclxuICAgICAgaWYgKHN0YXRlKSB7XHJcbiAgICAgICAgdGhpcy5fc2V0U3RhdGUodGhpcy5fY29tYmluZVN0YXRlKCksIG1hcCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjZW50ZXIpIHtcclxuICAgICAgICBtYXAuc2V0Q2VudGVyKGNlbnRlci5jdXJyZW50VmFsdWUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoem9vbSkge1xyXG4gICAgICAgIG1hcC5zZXRab29tKHpvb20uY3VycmVudFZhbHVlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBtYXAub3B0aW9ucy5zZXQob3B0aW9ucy5jdXJyZW50VmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAvKipcclxuICAgICAqIEl0IHNob3VsZCBiZSBhIG5vb3AgZHVyaW5nIHNlcnZlci1zaWRlIHJlbmRlcmluZy5cclxuICAgICAqL1xyXG4gICAgaWYgKHRoaXMuaXNCcm93c2VyKSB7XHJcbiAgICAgIGNvbnN0IHN1YiA9IHRoaXMuX3lhQXBpTG9hZGVyU2VydmljZS5sb2FkKCkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICBjb25zdCBpZCA9IGdlbmVyYXRlUmFuZG9tSWQoKTtcclxuICAgICAgICBjb25zdCBtYXAgPSB0aGlzLl9jcmVhdGVNYXAoaWQpO1xyXG5cclxuICAgICAgICB0aGlzLm1hcCQubmV4dChtYXApO1xyXG4gICAgICAgIHRoaXMuX2V2ZW50TWFuYWdlci5zZXRUYXJnZXQobWFwKTtcclxuICAgICAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHRoaXMucmVhZHkuZW1pdCh7IHltYXBzLCB0YXJnZXQ6IG1hcCB9KSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGhpcy5fc3ViLmFkZChzdWIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLl9ldmVudE1hbmFnZXIuZGVzdHJveSgpO1xyXG4gICAgdGhpcy5fc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXN0cnVjdHMgc3RhdGUgYW5kIHBhc3NlcyBpdCBpbiBBUEkuXHJcbiAgICogQHBhcmFtIHN0YXRlXHJcbiAgICogQHBhcmFtIG1hcFxyXG4gICAqL1xyXG4gIHByaXZhdGUgX3NldFN0YXRlKHN0YXRlOiB5bWFwcy5JTWFwU3RhdGUsIG1hcDogeW1hcHMuTWFwKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGJlaGF2aW9ycywgYm91bmRzLCBjZW50ZXIsIGNvbnRyb2xzLCBtYXJnaW4sIHR5cGUsIHpvb20gfSA9IHN0YXRlO1xyXG5cclxuICAgIGlmIChiZWhhdmlvcnMpIHtcclxuICAgICAgbWFwLmJlaGF2aW9ycy5lbmFibGUoYmVoYXZpb3JzKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYm91bmRzKSB7XHJcbiAgICAgIG1hcC5zZXRCb3VuZHMoYm91bmRzKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2VudGVyKSB7XHJcbiAgICAgIG1hcC5zZXRDZW50ZXIoY2VudGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY29udHJvbHMpIHtcclxuICAgICAgY29udHJvbHMuZm9yRWFjaCgoY29udHJvbCkgPT4gbWFwLmNvbnRyb2xzLmFkZChjb250cm9sKSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1hcmdpbikge1xyXG4gICAgICBtYXAubWFyZ2luLnNldERlZmF1bHRNYXJnaW4obWFyZ2luKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZSkge1xyXG4gICAgICBtYXAuc2V0VHlwZSh0eXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoem9vbSkge1xyXG4gICAgICBtYXAuc2V0Wm9vbSh6b29tKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBtYXAuXHJcbiAgICogQHBhcmFtIGlkIElEIHdoaWNoIHdpbGwgYmUgc2V0IHRvIHRoZSBtYXAgY29udGFpbmVyLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgX2NyZWF0ZU1hcChpZDogc3RyaW5nKTogeW1hcHMuTWFwIHtcclxuICAgIGNvbnN0IGNvbnRhaW5lckVsZW06IEhUTUxFbGVtZW50ID0gdGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudDtcclxuICAgIGNvbnRhaW5lckVsZW0uc2V0QXR0cmlidXRlKCdpZCcsIGlkKTtcclxuICAgIGNvbnRhaW5lckVsZW0uc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyc7XHJcblxyXG4gICAgcmV0dXJuIG5ldyB5bWFwcy5NYXAoaWQsIHRoaXMuX2NvbWJpbmVTdGF0ZSgpLCB0aGlzLm9wdGlvbnMgfHwge30pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tYmluZXMgdGhlIGNlbnRlciBhbmQgem9vbSBpbnRvIHNpbmdsZSBvYmplY3QuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY29tYmluZVN0YXRlKCk6IHltYXBzLklNYXBTdGF0ZSB7XHJcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc3RhdGUgfHwge307XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLi4uc3RhdGUsXHJcbiAgICAgIGNlbnRlcjogdGhpcy5jZW50ZXIgfHwgc3RhdGUuY2VudGVyIHx8IFswLCAwXSxcclxuICAgICAgem9vbTogdGhpcy56b29tID8/IHN0YXRlLnpvb20gPz8gMTAsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=